{
  "version": 3,
  "sources": ["../src/effect.ts", "../src/system.ts", "../src/ref.ts"],
  "sourcesContent": ["export let activeSub\r\n\r\nexport function effect(fn: Function) {\r\n  activeSub = fn\r\n  activeSub()\r\n  activeSub = undefined\r\n}\r\n", "import { RefImpl } from './ref'\r\n\r\nexport interface Link {\r\n  sub: Function\r\n  nextSub: Link | undefined\r\n  prevSub: Link | undefined\r\n}\r\nexport function propagate(subs: Link) {\r\n  let link = subs\r\n  const queuedEffect = []\r\n  while (link) {\r\n    queuedEffect.push(link.sub)\r\n    link = link.nextSub\r\n  }\r\n  queuedEffect.forEach(effect => effect())\r\n}\r\n\r\nexport function link(dep: RefImpl, sub: Function) {\r\n  const newLink: Link = {\r\n    sub,\r\n    nextSub: undefined,\r\n    prevSub: undefined,\r\n  }\r\n\r\n  if (!dep.subsTail) {\r\n    dep.subs = newLink\r\n    dep.subsTail = newLink\r\n  } else {\r\n    dep.subsTail.nextSub = newLink\r\n    newLink.prevSub = dep.subsTail\r\n    dep.subsTail = newLink\r\n  }\r\n}\r\n", "import { activeSub } from './effect'\r\nimport { link, propagate, Link } from './system'\r\n\r\nenum ReactivityFlags {\r\n  IS_REF = '__v_isRef',\r\n}\r\n\r\nexport class RefImpl {\r\n  _value;\r\n\r\n  [ReactivityFlags.IS_REF] = true\r\n\r\n  subs: Link\r\n  subsTail: Link\r\n  constructor(value: any) {\r\n    this._value = value\r\n  }\r\n\r\n  get value() {\r\n    trackRef(this)\r\n\r\n    return this._value\r\n  }\r\n\r\n  set value(newValue: any) {\r\n    this._value = newValue\r\n    trigerRef(this)\r\n  }\r\n}\r\n\r\nexport function ref(value: any) {\r\n  return new RefImpl(value)\r\n}\r\n\r\nexport function isRef(value: any): boolean {\r\n  return !!(value && value[ReactivityFlags.IS_REF])\r\n}\r\n\r\nexport function trackRef(dep: RefImpl) {\r\n  if (activeSub) {\r\n    link(dep, activeSub)\r\n  }\r\n}\r\n\r\nexport function trigerRef(dep: RefImpl) {\r\n  if (dep.subs) {\r\n    propagate(dep.subs)\r\n  }\r\n}\r\n"],
  "mappings": ";AAAO,IAAI;AAEJ,SAAS,OAAO,IAAc;AACnC,cAAY;AACZ,YAAU;AACV,cAAY;AACd;;;ACCO,SAAS,UAAU,MAAY;AACpC,MAAIA,QAAO;AACX,QAAM,eAAe,CAAC;AACtB,SAAOA,OAAM;AACX,iBAAa,KAAKA,MAAK,GAAG;AAC1B,IAAAA,QAAOA,MAAK;AAAA,EACd;AACA,eAAa,QAAQ,CAAAC,YAAUA,QAAO,CAAC;AACzC;AAEO,SAAS,KAAK,KAAc,KAAe;AAChD,QAAM,UAAgB;AAAA,IACpB;AAAA,IACA,SAAS;AAAA,IACT,SAAS;AAAA,EACX;AAEA,MAAI,CAAC,IAAI,UAAU;AACjB,QAAI,OAAO;AACX,QAAI,WAAW;AAAA,EACjB,OAAO;AACL,QAAI,SAAS,UAAU;AACvB,YAAQ,UAAU,IAAI;AACtB,QAAI,WAAW;AAAA,EACjB;AACF;;;ACzBO,IAAM,UAAN,MAAc;AAAA,EACnB;AAAA,EAEA,CAAC,wBAAsB,IAAI;AAAA,EAE3B;AAAA,EACA;AAAA,EACA,YAAY,OAAY;AACtB,SAAK,SAAS;AAAA,EAChB;AAAA,EAEA,IAAI,QAAQ;AACV,aAAS,IAAI;AAEb,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,MAAM,UAAe;AACvB,SAAK,SAAS;AACd,cAAU,IAAI;AAAA,EAChB;AACF;AAEO,SAAS,IAAI,OAAY;AAC9B,SAAO,IAAI,QAAQ,KAAK;AAC1B;AAEO,SAAS,MAAM,OAAqB;AACzC,SAAO,CAAC,EAAE,SAAS,MAAM,wBAAsB;AACjD;AAEO,SAAS,SAAS,KAAc;AACrC,MAAI,WAAW;AACb,SAAK,KAAK,SAAS;AAAA,EACrB;AACF;AAEO,SAAS,UAAU,KAAc;AACtC,MAAI,IAAI,MAAM;AACZ,cAAU,IAAI,IAAI;AAAA,EACpB;AACF;",
  "names": ["link", "effect"]
}
